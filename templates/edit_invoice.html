<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Edit Invoice - Golden Turf</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='invoice.css') }}" />
</head>
<body>
    {% include '_sidebar.html' %}
    <div class="container" style="margin-left: 280px; padding: 30px 50px; width: calc(100vw - 330px); box-sizing: border-box;">
        <div style="max-width: 600px; margin: 0 auto;">
            <header>
                <h1 style="text-align: center; margin-bottom: 30px;">Edit Invoice Details</h1> 
            </header>
            {% if error %}
                <div class="error" style="background: #fee; color: #c33; padding: 15px; border-radius: 5px; margin-bottom: 20px; text-align: center;">{{ error }}</div>
            {% endif %}
            <form method="POST" action="{{ url_for('edit_invoice', invoice_id=invoice[0]) }}" style="background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <label for="client_name">Client Name:</label>
            <select id="client_name" name="client_name" required>
                {% for client in clients %}
                <option value="{{ client }}" {% if client == invoice[1] %}selected{% endif %}>{{ client }}</option>
                {% endfor %}
            </select>

            <label for="product">Product:</label>
            <input type="text" id="product" name="product" value="{{ invoice[2] }}" list="products" required />
            <datalist id="products">
                {% for product in products %}
                <option value="{{ product }}">
                {% endfor %}
            </datalist>

            <label for="quantity">Quantity:</label>
            <input type="number" step="0.01" id="quantity" name="quantity" value="{{ invoice[3] }}" required />

            <label for="price">Price:</label>
            <input type="number" step="0.01" id="price" name="price" value="{{ invoice[4] }}" readonly />

            <label for="gst_checkbox" style="font-weight: normal; font-size: 1rem; cursor: pointer;">Apply GST (10%):</label>
            <input type="checkbox" id="gst_checkbox" name="gst_checkbox" value="yes" style="width: 24px; height: 24px; cursor: pointer;" {% if invoice[5] > 0 %}checked{% endif %} />

            <label for="total">Total:</label>
            <input type="number" step="0.01" id="total" name="total" value="{{ invoice[6] }}" readonly />

            <label for="status">Status:</label>
            <select id="status" name="status" required>
                <option value="Paid" {% if invoice[7] == 'Paid' %}selected{% endif %}>Paid</option>
                <option value="Unpaid" {% if invoice[7] == 'Unpaid' %}selected{% endif %}>Unpaid</option>
            </select>

            <button type="submit" style="width: 100%; background: #006400; color: white; border: none; padding: 15px; border-radius: 5px; font-size: 16px; cursor: pointer; margin-top: 20px;">Update Invoice</button>
        </form>
        </div>
    </div>
    <script>
        const priceTable = JSON.parse('{{ price_table | tojson() | safe }}');
        const productSelect = document.getElementById('product');
        const priceInput = document.getElementById('price');
        const quantityInput = document.getElementById('quantity');
        const totalInput = document.getElementById('total');
        const gstCheckbox = document.getElementById('gst_checkbox');

        function updatePriceAndTotal() {
            const selectedProduct = productSelect.value;
            const quantity = parseFloat(quantityInput.value) || 0;
            const unitPrice = priceTable[selectedProduct];
            if (unitPrice !== undefined) {
                const basePrice = unitPrice * quantity;
                priceInput.value = basePrice.toFixed(2);
                let total = basePrice;
                if (gstCheckbox.checked) {
                    total = total * 1.1; // Add 10% GST
                }
                totalInput.value = total.toFixed(2);
            } else {
                priceInput.value = '';
                totalInput.value = '';
            }
        }

        productSelect.addEventListener('change', updatePriceAndTotal);
        quantityInput.addEventListener('input', updatePriceAndTotal);
        gstCheckbox.addEventListener('change', updatePriceAndTotal);

        // Initialize on page load
        updatePriceAndTotal();
    </script>
</body>
</html>
