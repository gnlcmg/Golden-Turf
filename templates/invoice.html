<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Invoice - Golden Turf</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='invoice.css') }}" />
</head>
<body>
    <div class="sidebar">
        <div class="logo-container">
            <img src="/static/logo.png" alt="Golden Turf Logo" class="logo" />
        </div>
    </div>
    <link rel="stylesheet" href="{{ url_for('static', filename='dashboard.css') }}">
    <div class="sidebar">
        <div style="width:100%;text-align:center;margin-bottom:20px;">
            <img src="/static/golden_turf_logo.png" alt="Golden Turf Logo" style="width:100px;display:block;margin:0 auto;">
        </div>
        <h2>Golden Turf</h2>
        <nav>
            <a href="/dashboard">Dashboard</a>
            <div class="nav-dropdown" id="products-sidebar-dropdown">
                <a href="#" class="dropbtn">Products</a>
                <div class="dropdown-content">
                    <a href="/products-list">Product List</a>
                    <a href="/clients">Client Details Form</a>
                    <a href="/invoice">Invoice Form</a>
                    <a href="/list">Clients & Invoices List</a>
                </div>
            </div>
            <a href="#">Quotes</a>
            <a href="/payments">Payments</a>
            <a href="#">Reports</a>
            <a href="/calendar">Calendar</a>
        </nav>
    </div>
    <div class="container" style="margin-left:220px;">
        <header>
            <h1>Invoice Form</h1>
        </header>

            <form method="POST" action="{{ url_for('invoice') }}">
            {% if success %}
                <div class="success" style="background:#44ff44;color:#222;padding:10px 18px;border-radius:8px;margin-bottom:18px;font-weight:600;text-align:center;">{{ success }}</div>
            {% elif error %}
                <div class="error" style="background:#ff4444;color:#fff;padding:10px 18px;border-radius:8px;margin-bottom:18px;font-weight:600;text-align:center;">{{ error }}</div>
            {% endif %}
            <section class="client-info">
                <h2>Client Information</h2>
                <label for="client_name">Client Name:</label>
                <input type="text" id="client_name" name="client_name" value="{{ client_name or '' }}" required />

                <label for="due_date">Due Date:</label>
                <input type="date" id="due_date" name="due_date" value="{{ due_date or '' }}" required />

                <label for="turf_type">Turf Type:</label>
                <select id="turf_type" name="turf_type" required>
                    <option value="none" {% if turf_type == 'none' %}selected{% endif %}>None</option>
                    <option value="Golden Imperial Lush" {% if turf_type == 'Golden Imperial Lush' %}selected{% endif %}>Golden Imperial Lush</option>
                    <option value="Golden Green Lush" {% if turf_type == 'Golden Green Lush' %}selected{% endif %}>Golden Green Lush</option>
                    <option value="Golden Natural 40mm" {% if turf_type == 'Golden Natural 40mm' %}selected{% endif %}>Golden Natural 40mm</option>
                    <option value="Golden Golf Turf" {% if turf_type == 'Golden Golf Turf' %}selected{% endif %}>Golden Golf Turf</option>
                    <option value="Golden Premium Turf" {% if turf_type == 'Golden Premium Turf' %}selected{% endif %}>Golden Premium Turf</option>
                </select>

                <label for="area">Area (sq meters):</label>
                <input type="number" id="area" name="area" min="0.01" step="0.01" value="{{ area or '' }}" required />

                <label for="extra_fee">Extra Fee:</label>
                <input type="number" id="extra_fee" name="extra_fee" min="0" step="0.01" value="{{ extra_fee or 0 }}" />

                <label for="extras">Extras:</label>
                <select id="extras" name="extras">
                    <option value="none" {% if extras == 'none' %}selected{% endif %}>None</option>
                    <option value="artificial_hedges" {% if extras == 'artificial_hedges' %}selected{% endif %}>Artificial Hedges</option>
                    <option value="fountain" {% if extras == 'fountain' %}selected{% endif %}>Fountain</option>
                    <option value="bamboo_products" {% if extras == 'bamboo_products' %}selected{% endif %}>Bamboo Products</option>
                    <option value="polished_pebbles" {% if extras == 'polished_pebbles' %}selected{% endif %}>Polished/Glowing Pebbles</option>
                    <option value="pegs" {% if extras == 'pegs' %}selected{% endif %}>Pegs (U-pins/Nails)</option>
                </select>

                {% set extras_costs = {
                    'none': 0,
                    'artificial_hedges': 50,
                    'fountain': 150,
                    'bamboo_products': 75,
                    'polished_pebbles': 40,
                    'pegs': 20
                } %}

                <label for="discount">Discount:</label>
                <input type="number" id="discount" name="discount" min="0" step="0.01" value="{{ discount or 0 }}" />

                <label for="payment_status">Payment Status:</label>
                <select id="payment_status" name="payment_status" required>
                    <option value="" disabled selected>Select payment status</option>
                    <option value="Paid" {% if payment_status == 'Paid' %}selected{% endif %}>Paid</option>
                    <option value="Unpaid" {% if payment_status == 'Unpaid' %}selected{% endif %}>Unpaid</option>
                    <option value="Overdue" {% if payment_status == 'Overdue' %}selected{% endif %}>Overdue</option>
                </select>

                <label for="gst">Apply GST (7%):</label>
                <input type="checkbox" id="gst" name="gst" value="yes" {% if gst == 'yes' %}checked{% endif %} />
            </section>

            <section class="invoice-summary">
                <div style="width:100%;text-align:center;margin-bottom:10px;">
                    <img src="/static/golden_turf_logo.png" alt="Golden Turf Logo" style="width:100px;display:block;margin:0 auto;">
                </div>
                <h2 style="text-align:center;">Invoice Summary</h2>
                <div class="invoice-summary-vertical" style="max-width:400px;margin:auto;">
                    <table style="width:100%;border-collapse:collapse;">
                        <tbody>
                            <tr><th style="text-align:left;width:50%;padding:8px;border-bottom:1px solid #ccc;">Client Name</th><td style="padding:8px;border-bottom:1px solid #eee;">{{ client_name or '' }}</td></tr>
                            <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #ccc;">Turf Type</th><td style="padding:8px;border-bottom:1px solid #eee;">{{ turf_type or '' }}</td></tr>
                            <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #ccc;">Area (sq m)</th><td style="padding:8px;border-bottom:1px solid #eee;">{{ area or 0 }}</td></tr>
                            <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #ccc;">Extra Fee</th><td style="padding:8px;border-bottom:1px solid #eee;">${{ "%.2f"|format(extra_fee or 0) }}</td></tr>
                            <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #ccc;">Extras</th><td style="padding:8px;border-bottom:1px solid #eee;">{{ extras or 'None' }}</td></tr>
                            <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #ccc;">Discount</th><td style="padding:8px;border-bottom:1px solid #eee;">${{ "%.2f"|format(discount or 0) }}</td></tr>
                            <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #ccc;">Total</th><td style="padding:8px;border-bottom:1px solid #eee;">
                                {% set extra_cost = extras_costs.get(extras, 0) %}
                                {% if area and area > 0 %}
                                    {% set subtotal = (area or 0) + (extra_fee or 0) + extra_cost - (discount or 0) %}
                                {% else %}
                                    {% set subtotal = (extra_fee or 0) + extra_cost - (discount or 0) %}
                                {% endif %}
                                {% if subtotal < 0 %}
                                    <span class="error">Invalid total amount</span>
                                {% else %}
                                    {% if gst == 'yes' %}
                                        {% set gst_amount = subtotal * 0.07 %}
                                        {% set total = subtotal + gst_amount %}
                                        ${{ "%.2f"|format(total) }} (incl. GST ${{ "%.2f"|format(gst_amount) }})
                                    {% else %}
                                        {% set total = subtotal %}
                                        ${{ "%.2f"|format(total) }}
                                    {% endif %}
                                {% endif %}
                            </td></tr>
                            <tr><th style="text-align:left;padding:8px;border-bottom:1px solid #ccc;">Payment Status</th><td style="padding:8px;border-bottom:1px solid #eee;">{{ payment_status or '' }}</td></tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <div class="form-actions">
                <button type="submit">Submit Invoice</button>
                <button type="button" onclick="printSummaryTable()">Print Invoice</button>
            </div>
        </form>
    </div>

    <script>
        const turfTypeSelect = document.getElementById('turf_type');
        const areaInput = document.getElementById('area');

        function toggleAreaRequirement() {
            if (turfTypeSelect.value === 'none') {
                areaInput.value = '';
                areaInput.required = false;
                areaInput.disabled = true;
            } else {
                areaInput.required = true;
                areaInput.disabled = false;
            }
        }

        turfTypeSelect.addEventListener('change', toggleAreaRequirement);

        // Initialize on page load
        toggleAreaRequirement();

        // Print only the invoice summary table
        function printSummaryTable() {
            var summarySection = document.querySelector('.invoice-summary');
            var printWindow = window.open('', '', 'height=600,width=900');
            printWindow.document.write('<html><head><title>Invoice Summary</title>');
            printWindow.document.write('<link rel="stylesheet" href="/static/invoice.css">');
            printWindow.document.write('</head><body >');
            printWindow.document.write(summarySection.innerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
            printWindow.close();
        }
    </script>
