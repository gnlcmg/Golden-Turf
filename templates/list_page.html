<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Client & Invoices List - Golden Turf</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='invoice.css') }}" />
    <script>
        function toggleView() {
            var selection = document.getElementById('view-select').value;
            if (selection === 'clients') {
                document.getElementById('clients-table').style.display = 'table';
                document.getElementById('invoices-table').style.display = 'none';
            } else {
                document.getElementById('clients-table').style.display = 'none';
                document.getElementById('invoices-table').style.display = 'table';
            }
        }
        window.onload = function() {
            toggleView();
        };
    </script>
</head>
<body>
    <div class="sidebar">
        <div class="logo-section">
            <img src="{{ url_for('static', filename='logo.png') }}" alt="Golden Turf Logo" class="logo-img" />
            <div class="logo-text">GOLDEN<span style="color:#f4a261;">TURF</span></div>
        </div>
        <nav class="sidebar-nav">
            <a href="/dashboard" class="return-dashboard-link">Return to Dashboard</a>
        </nav>
    </div>
    <div class="container">
    <header>
        <h1>Client & Invoices List</h1>
        <label for="view-select">View:</label>
        <input type="text" id="search-input" placeholder="Search..." onkeyup="filterTable()" />
        <select id="view-select" onchange="toggleView()">
            <option value="clients">Clients</option>
            <option value="invoices">Invoices</option>
        </select>
    </header>

        <section id="clients-section">
            <table id="clients-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Client Name</th>
                        <th>Phone</th>
                        <th>Created Date</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for client in clients %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ client[1] }}</td>
                        <td>{{ client[2] or '' }}</td>
                        <td>{{ client[3] or '' }}</td>
                        <td>{{ client[4] }}</td>
                        <td>
                            <form method="GET" action="{{ url_for('edit_client', client_id=client[0]) }}" style="display:inline;">
                                <button type="submit" class="link-button">Edit</button>
                            </form> |
                            <form method="POST" action="{{ url_for('delete_client', client_id=client[0]) }}" style="display:inline;">
                                <button type="submit" onclick="return confirm('Are you sure you want to delete this client?');" class="link-button">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6">No clients found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>

        <section id="invoices-section">
            <table id="invoices-table">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Client Name</th>
                        <th>Turf Type</th>
                        <th>Area (sq m)</th>
                        <th>Extra Fee</th>
                        <th>Extras</th>
                        <th>Discount</th>
                        <th>Total (incl. GST)</th>
                        <th>Payment Status</th>
                        <th>Invoice Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for invoice in invoices %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td>{{ invoice[1] or '' }}</td>
                        <td>{{ invoice[2] or '' }}</td>
                        <td>{{ invoice[3] or 0 }}</td>
                        <td>${{ "%.2f"|format(invoice[4] or 0) }}</td>
                        <td>{{ invoice[5] or 'None' }}</td>
                        <td>${{ "%.2f"|format(invoice[6] or 0) }}</td>
                        <td>${{ "%.2f"|format(invoice[7] or 0) }}</td>
                        <td>{{ invoice[8] or '' }}</td>
                        <td>{{ invoice[9] or '' }}</td>
                        <td>
                            <form method="GET" action="{{ url_for('edit_invoice', invoice_id=invoice[0]) }}" style="display:inline;">
                                <button type="submit" class="link-button">Edit</button>
                            </form> |
                            <form method="POST" action="{{ url_for('delete_invoice', invoice_id=invoice[0]) }}" style="display:inline;">
                                <button type="submit" onclick="return confirm('Are you sure you want to delete this invoice?');" class="link-button">Delete</button>
                            </form>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="11">No invoices found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </div>
<script>
    function filterTable() {
        var input, filter, table, tr, td, i, j, txtValue, visible;
        input = document.getElementById("search-input");
        filter = input.value.toLowerCase();
        var view = document.getElementById("view-select").value;
        if (view === "clients") {
            table = document.getElementById("clients-table");
        } else {
            table = document.getElementById("invoices-table");
        }
        tr = table.getElementsByTagName("tr");
        for (i = 1; i < tr.length; i++) {
            tr[i].style.display = "none";
            td = tr[i].getElementsByTagName("td");
            visible = false;
            for (j = 0; j < td.length; j++) {
                if (td[j]) {
                    txtValue = td[j].textContent || td[j].innerText;
                    if (txtValue.toLowerCase().indexOf(filter) > -1) {
                        visible = true;
                        break;
                    }
                }
            }
            if (visible) {
                tr[i].style.display = "";
            }
        }
    }
</script>
</body>
</html>
